---
title: "restructure_dataset"
output: github_document
date: "2025-04-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown
importing the huge data set that needs lots of restructuring.

```{r}
library(ggplot2)
library(dplyr)
library(readxl)
library(reshape2)
library(tidyr)

#import the data
tabn331_10 <- read_excel("tabn331.10.xlsx", 
      skip = 4, n_max = 43)

#make a copy of your data set

big_dataset <- tabn331_10

#remove the rows and columns that are only NA values

big_dataset <- big_dataset[-c(2, 6, 14, 18, 22, 25, 39), ]


big_dataset <- big_dataset[, colSums(is.na(big_dataset)) != nrow(big_dataset)]

#rename the columns
names(big_dataset) <- c("category", "total_in_thousands", "total_anyaid", "se_total_anyaid", "federal_anyaid", "se_federal_anyaid", "nonfederal_anyaid", "se_nonfederal_anyaid", "total_grants", "se_total_grant", "federal_grants", "se_federal_grants", "nonfederal_grants", "se_nonfederal_grants", "total_loans", "se_total_loans", "federal_loans", "se_federal_loans", "nonfederal_loans","remove_1" ,"se_nonfederal_loans", "total_workstudy","remove_2" ,"se_total_workstudy")

#remove those final columns
big_dataset <- big_dataset %>% select(-remove_1, -remove_2)

#add a column for the year of the dataset
big_dataset <- big_dataset %>% mutate(year = "2019-20")

```


Now I have the data cleaned with all the NA's removed. I am going to create subsets of the data for each category such as age, gender, race, etc.
```{r}
#dataset for gender
big_dataset_gender <- big_dataset[2:4, ]

#dataset for 
big_dataset_race <- big_dataset[5:11, ]

#for age
big_dataset_age <- big_dataset[12:14, ]

#for marital status
big_dataset_marital <- big_dataset[15:17, ]

#for attendance status
big_dataset_attendance <- big_dataset[18:19, ]

#for dependency status and income (income by dependency status)
big_dataset_dependency_and_income <- big_dataset[20:32, ]

#for housing status
big_dataset_housing <- big_dataset[33:36, ]
```


In the section below I am taking another data set that had all the years and different aid for different types of institutions.

```{r}
timeline_dataset <- read_excel("timeline_dataset.xlsx", 
      skip = 5)

#get rid of na rows
timeline_dataset <- timeline_dataset[-c(23, 34, 45, 56, 67, 78, 89, 100, 111, 122, 123,124, 125, 126), ]

#rename
names(timeline_dataset) <- c("year", "number_enrolled", "number_awarded_aid", "percent_awarded_aid", "percent_federal", "percent_state_local_grants", "percent_institutional_grants", "percent_student_loans", "dollars_federal", "dollars_state_local_grants", "dollars_institutional_grants", "dollars_student_loans", "constant_federal", "constant_state_local_grants", "constant_institutional", "constant_loans")

#create subsets
#subset for all institutions
timeline_dataset_all_institutions <- timeline_dataset[1:22, ]

#subset for public institutions
timeline_dataset_public_institutions <- timeline_dataset[23:52, ]

#subset for private non-profit 
timeline_dataset_private_nonprofit <- timeline_dataset[53:82, ]

#subset for private for-profit 
timeline_dataset_private_forprofit <- timeline_dataset[83:112, ]

#for each subset add the columns with 4-year or 2-year for public institutions 
timeline_dataset_public_institutions <- timeline_dataset_public_institutions %>% mutate(type = c("all", "all", "all", "all", "all", "all", "all", "all", "all", "all", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year"))

#for each subset add the columns with 4-year or 2-year or all for private non-profit 
timeline_dataset_private_nonprofit <- timeline_dataset_private_nonprofit %>% mutate(type = c("all", "all", "all", "all", "all", "all", "all", "all", "all", "all", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year"))

#for each subset add the columns with 4-year or 2-year or all for private for-profit 
timeline_dataset_private_forprofit <- timeline_dataset_private_forprofit %>% mutate(type = c("all", "all", "all", "all", "all", "all", "all", "all", "all", "all", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "4_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year", "2_year"))
```


Lets see if we can create some visuals from this
```{r}
#first just a graph of how student loans have changed over time.

ggplot(timeline_dataset_all_institutions, aes(x = year, y = dollars_student_loans)) +
  geom_line(color = "blue") +
  labs(title = "Student Loans Over Time",
       x = "Year",
       y = "Student Loans") +
  theme_minimal()

```

